<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="TaskPilot.Client.MainPage"
             Shell.NavBarIsVisible="False"
             BackgroundColor="#F5F5F7">

    <ScrollView>
        <VerticalStackLayout Padding="30,40" Spacing="25">

            <!-- HEADER -->
            <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,20">
                <VerticalStackLayout Spacing="5" VerticalOptions="Center">
                    <Label x:Name="LabelStudentName"
                           Text="Name"
                           FontSize="30"
                           FontAttributes="Bold"
                           TextColor="#1A1D3F" />
                    <Label Text="â€œStay focused. Keep working towards your goals â€” one task at a time.â€"
                           FontSize="14"
                           TextColor="#555" />
                </VerticalStackLayout>
            </Grid>

            <!-- ONGOING PROJECTS HEADER -->
            <Grid ColumnDefinitions="*,Auto">
                <HorizontalStackLayout Spacing="12" VerticalOptions="Center">
                    <Label Text="Ongoing Projects"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="#1A1D3F"/>
                    <Button Text="{Binding ViewAllButtonText}"
                            Command="{Binding ViewAllProjectsCommand}"
                            BackgroundColor="Transparent"
                            TextColor="#1A1D3F"/>
                </HorizontalStackLayout>

            </Grid>

            <!-- TASKS COLLECTION -->
            <CollectionView x:Name="TodosCollection"
                            ItemsSource="{Binding listOfTodos}"
                            SelectionMode="None"
                            Margin="0,15,0,0">

                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical"
                                     Span="1"
                                     VerticalItemSpacing="15"
                                     HorizontalItemSpacing="0" />
                </CollectionView.ItemsLayout>

                <!-- EMPTY STATE -->
                <CollectionView.EmptyView>
                    <VerticalStackLayout Padding="20"
                                         HorizontalOptions="Center"
                                         VerticalOptions="Center">
                        <Label Text="No tasks yet ðŸŽ‰"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="#1A1D3F"
                               HorizontalOptions="Center"/>
                        <Label Text="Add your first task to get started."
                               FontSize="14"
                               TextColor="#666"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

                <!-- TEMPLATE -->
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid ColumnDefinitions="Auto, *, Auto" ColumnSpacing="12" Padding="15,10">

                            <!-- Column 0: The CheckBox -->
                            <CheckBox Grid.Column="0"
                                      IsChecked="{Binding IsCompleted}"
                                      Command="{Binding ToggleCompleteCommand}"
                                      Color="#5A67D8"
                                      VerticalOptions="Center" />

                            <!-- Column 1: Title and Due Date -->
                            <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">

                                <!-- The Task Title Label with dynamic styling -->
                                <Label Text="{Binding Title}" FontSize="16">
                                    <Label.Style>
                                        <Style TargetType="Label">
                                            <Setter Property="TextColor" Value="#1A1D3F" />
                                            <Setter Property="TextDecorations" Value="None" />
                                            <Style.Triggers>
                                                <DataTrigger TargetType="Label" Binding="{Binding IsCompleted}" Value="True">
                                                    <Setter Property="TextColor" Value="Gray" />
                                                    <Setter Property="TextDecorations" Value="Strikethrough" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Label.Style>
                                </Label>

                                <!-- The Due Date Label with dynamic styling -->
                                <Label Text="{Binding DueDateTime, StringFormat='Due: {0:ddd, MMM d}'}" FontSize="13">
                                    <Label.Style>
                                        <Style TargetType="Label">
                                            <Setter Property="TextColor" Value="#666" />
                                            <Style.Triggers>
                                                <DataTrigger TargetType="Label" Binding="{Binding IsCompleted}" Value="True">
                                                    <Setter Property="TextColor" Value="LightGray" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Label.Style>
                                </Label>
                            </VerticalStackLayout>

                            <!-- Column 2: The existing "More Options" Button -->
                            <Button Grid.Column="2"
                                        Text="â‹®"
                                        Clicked="OnMenuClicked"
                                        VerticalOptions="Center"
                                        BackgroundColor="Transparent"
                                        TextColor="#999"
                                        FontSize="20"
                                        Padding="0"/>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!--<Grid Grid.Row="2" Padding="10,5" BackgroundColor="White" HeightRequest="65">

                --><!-- Home --><!--
                <VerticalStackLayout Grid.Column="0" HorizontalOptions="Center" VerticalOptions="Center">
                    <Button 
                        Text="Home"
                        FontSize="12"
                        TextColor="#666666"
                        BackgroundColor="Transparent"/>
                        --><!--Clicked="OnHomeClicked"--><!-- 
                </VerticalStackLayout>
                --><!-- Tasks --><!--
                <VerticalStackLayout Grid.Column="1" HorizontalOptions="Center" VerticalOptions="Center">
                    <Button 
                        Text="Tasks"
                        FontSize="12"
                        TextColor="#666666"
                        BackgroundColor="Transparent"/>
                    --><!--Clicked="OnTasksClicked" />--><!--
                </VerticalStackLayout>
                --><!-- Settings (Active) --><!--
                <VerticalStackLayout Grid.Column="2" HorizontalOptions="Center" VerticalOptions="Center">
                    <Button 
                        Text="Settings"
                        FontSize="12"
                        TextColor="#666666"
                        BackgroundColor="Transparent"
                        IsEnabled="False" />
                </VerticalStackLayout>
                --><!-- Profile --><!--
                <VerticalStackLayout Grid.Column="3" HorizontalOptions="Center" VerticalOptions="Center">
                    <Button 
                        Text="Profile"
                        FontSize="12"
                        TextColor="#666666"
                        BackgroundColor="Transparent"/>
                        --><!--Clicked="OnProfileClicked"--><!-- 
                </VerticalStackLayout>
            </Grid>-->
        </VerticalStackLayout>
    </ScrollView>

</ContentPage>