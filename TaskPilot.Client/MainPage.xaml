<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="TaskPilot.Client.MainPage"
             Shell.NavBarIsVisible="False"
             BackgroundColor="#F5F5F7">

    <ScrollView>
        <VerticalStackLayout Padding="30,40" Spacing="25">

            <!-- HEADER -->
            <Grid ColumnDefinitions="Auto,*,Auto" Margin="0,0,0,20" VerticalOptions="Center">

                <!-- Task icon -->
                <Image Grid.Column="0"
                       Source="task_pilot_icon.jpg"
                       WidthRequest="60"
                       HeightRequest="60"
                       HorizontalOptions="Start"
                       VerticalOptions="Center"
                       Margin="0,0,15,0"/>

                <!-- Center: Title and quote -->
                <VerticalStackLayout Grid.Column="1" Spacing="5" VerticalOptions="Center">
                    <Label x:Name="LabelStudentName"
                           Text="Name"
                           FontSize="30"
                           FontAttributes="Bold"
                           TextColor="#1A1D3F" />
                    <Label Text="â€œStay focused. Keep working towards your goals ,one task at a time.â€"
                           FontSize="14"
                           TextColor="#555" />
                </VerticalStackLayout>

                <!-- Bell icon -->
                <Image Grid.Column="2"
                       Source="bell_icon.jpg"
                       WidthRequest="45"
                       HeightRequest="45"
                       HorizontalOptions="End"
                       VerticalOptions="Center"/>
            </Grid>

            <!-- Pomodoro Timer Section -->
            <Frame BackgroundColor="White"
                   CornerRadius="10"
                   Padding="20"
                   HasShadow="True">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Pomodoro Timer"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="#1A1D3F"
                           HorizontalOptions="Center" />

                    <Label x:Name="TimerDisplayLabel"
                           Text="25:00"
                           FontSize="72"
                           FontAttributes="Bold"
                           TextColor="#1A1D3F"
                           HorizontalOptions="Center" />

                    <Button x:Name="StartStopButton"
                            Text="Start Pomodoro"
                            Clicked="OnStartStopButtonClicked"
                            CornerRadius="8"
                            HorizontalOptions="Center"
                            BackgroundColor="#1A1D3F"
                            TextColor="White"
                            FontSize="Medium"
                            FontAttributes="Bold" />
                </VerticalStackLayout>
            </Frame>

            <!-- Ongoing Projects Section -->
            <Grid ColumnDefinitions="*,Auto" Margin="0,15,0,0">
                <HorizontalStackLayout Spacing="12" VerticalOptions="Center" Grid.Column="0">
                    <Label Text="Ongoing Projects"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="#1A1D3F"/>
                </HorizontalStackLayout>

                <Button Text="{Binding ViewAllButtonText}"
                        Command="{Binding ViewAllProjectsCommand}"
                        BackgroundColor="Transparent"
                        TextColor="#1A1D3F"
                        Grid.Column="1"/>
            </Grid>

            <!-- Tasks Collection -->
            <CollectionView x:Name="TodosCollection"
                            ItemsSource="{Binding listOfTodos}"
                            SelectionMode="None"
                            Margin="0,15,0,0">

                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical"
                                     Span="1"
                                     VerticalItemSpacing="15"
                                     HorizontalItemSpacing="0" />
                </CollectionView.ItemsLayout>

                <!-- Empty State -->
                <CollectionView.EmptyView>
                    <VerticalStackLayout Padding="20"
                                         HorizontalOptions="Center"
                                         VerticalOptions="Center">
                        <Label Text="No tasks yet ðŸŽ‰"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="#1A1D3F"
                               HorizontalOptions="Center"/>
                        <Label Text="Add your first task to get started."
                               FontSize="14"
                               TextColor="#666"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

                <!-- Task Template -->
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12" Padding="15,10">

                            <CheckBox Grid.Column="0"
                                      IsChecked="{Binding IsCompleted}"
                                      Command="{Binding ToggleCompleteCommand}"
                                      Color="#5A67D8"
                                      VerticalOptions="Center" />

                            <VerticalStackLayout Grid.Column="1" Spacing="2" VerticalOptions="Center">
                                <Label Text="{Binding Title}" FontSize="16">
                                    <Label.Style>
                                        <Style TargetType="Label">
                                            <Setter Property="TextColor" Value="#1A1D3F" />
                                            <Setter Property="TextDecorations" Value="None" />
                                            <Style.Triggers>
                                                <DataTrigger TargetType="Label" Binding="{Binding IsCompleted}" Value="True">
                                                    <Setter Property="TextColor" Value="Gray" />
                                                    <Setter Property="TextDecorations" Value="Strikethrough" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Label.Style>
                                </Label>

                                <Label Text="{Binding DueDateTime, StringFormat='Due: {0:ddd, MMM d}'}" FontSize="13">
                                    <Label.Style>
                                        <Style TargetType="Label">
                                            <Setter Property="TextColor" Value="#666" />
                                            <Style.Triggers>
                                                <DataTrigger TargetType="Label" Binding="{Binding IsCompleted}" Value="True">
                                                    <Setter Property="TextColor" Value="LightGray" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Label.Style>
                                </Label>
                            </VerticalStackLayout>

                            <Button Grid.Column="2"
                                    Text="â‹®"
                                    Clicked="OnMenuClicked"
                                    VerticalOptions="Center"
                                    BackgroundColor="Transparent"
                                    TextColor="#999"
                                    FontSize="20"
                                    Padding="0"/>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
